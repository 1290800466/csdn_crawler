<!DOCTYPE html>
            <html>
              <head>
                <meta http-equiv="content-type" content="text/html; charset=utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
                <meta name="apple-mobile-web-app-status-bar-style" content="black">

                <meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />

                <title></title>
              </head>
              <body><div class="skin_detail" id="article_content">&#13;
                        &#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">目前微信是很火的，微信支付目前很少在网上能看到一系列详细的demo，因此，花一点时间来做一下关于微信支付系列教程，本次教程是JSAPI模式支付，其他的还会继续写下去</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="font-size:18px"><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; line-height:28.8px">首先，下载微信支付的demo，我们根据微信上的demo来整合到TP中。</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; line-height:28.8px"/><a target="_blank" href="https://github.com/1290800466/mac_win/tree/master/weixin_pay/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%94%AF%E4%BB%98DEMO/wx2">demo下载地址：https://github.com/1290800466/mac_win/tree/master/weixin_pay/%E5%85%AC%E4%BC%97%E8%B4%A6%E5%8F%B7%E6%94%AF%E4%BB%98DEMO/wx2</a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; line-height:28.8px">介绍下我们这里需要用到的几个文件：</span></span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b3ff84071d.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b3ff84071d.png" width="685" height="403" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">在demo文件夹中：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">js_api_call.php:提供了微信jsapi的主要功能</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">log_.php：提供打印日志功能</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">notify_url.php：异步通知功能</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">notify_url.log：异步通知日志</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">qrcode.js：生成二维码js插件</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来介绍下WxPayPubHelper文件夹下的文件：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4117582d2.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4117582d2.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">cacert 文件夹是存放微信证书的（PS：具体我还没怎么用证书，虽然下载下来了，证书请在微信商户平台上下载）</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">SDKRuntimeException.php：这个就是处理异常的、</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">WxPay.pub.config.php：这个是做一些配置的，稍后会详细讲解</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">WxPayPubHelper.php：这个其实就是微信支付的工具类，对于初学者只要知道怎么用他里面的方法就够了</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">OK，了解了微信官方提供的文件，我们就可以开始整合到TP中了，废话不多说，这就开始！</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step1:将demo中的WxPayPubHelper整个文件夹都复制到TP的Vendor目录下，像我这样：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b438c3c9e4.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b438c3c9e4.png" width="299" height="541" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step2:配置WxPay.pub.config.php文件：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4460075cc.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4460075cc.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">这里的配置都有注释，如果还有不懂或者配置出现问题可以留言提问</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">同时我把微信的这个配置放到了TP的config中，这一步大家可以随意</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pun" style="color:rgb(102,102,0)">&lt;?</span><span class="pln" style="color:rgb(0,0,0)">php</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">return</span><span class="pln" style="color:rgb(0,0,0)"> array</span><span class="pun" style="color:rgb(102,102,0)">(</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="com" style="color:rgb(136,0,0)">//'配置项'=&gt;'配置值'</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    define</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WEB_HOST'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'这是您的网站域名地址'</span><span class="pun" style="color:rgb(102,102,0)">),</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="com" style="color:rgb(136,0,0)">/*微信支付配置*/</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub'</span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)">array</span><span class="pun" style="color:rgb(102,102,0)">(</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'APPID'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'您的APPID'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'MCHID'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'您的商户ID'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'KEY'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'商户秘钥'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'APPSECRET'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'您的APPSECRET'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'JS_API_CALL_URL'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> WEB_HOST</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">'/index.php/Home/WxJsAPI/jsApiCall'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'SSLCERT_PATH'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> WEB_HOST</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">'/ThinkPHP/Library/Vendor/WxPayPubHelper/cacert/apiclient_cert.pem'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'SSLKEY_PATH'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> WEB_HOST</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">'/ThinkPHP/Library/Vendor/WxPayPubHelper/cacert/apiclient_key.pem'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'NOTIFY_URL'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)">  WEB_HOST</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">'/index.php/Home/WxJsAPI/notify'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="str" style="color:rgb(0,136,0)">'CURL_TIMEOUT'</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">=&gt;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="lit" style="color:rgb(0,102,102)">30</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">)</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">);</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_1" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step3:将生成二维码的js放在Public目录下（这里目前用不到，在用扫码支付的情况才用到这个js），将日志文件放在Public目录下：像我这样：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b44dc05008.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b44dc05008.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step4:创建控制器：这里创建了一个WxJsAPIController的控制器，这里大家随便起名字，只要这个跟你们在公众平台上的设置相对应就可以（公众平台设置稍后介绍）</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4686f3257.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4686f3257.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">下面是控制器的代码部分了，首先初始化控制器，将WxPayPubHelper导入</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">/**</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">     * 初始化</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">     */</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> _initialize</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//引入WxPayPubHelper</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        vendor</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayPubHelper.WxPayPubHelper'</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_2" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来是使用统一支付接口，获取prepay_id的方法：</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用jsapi接口</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $jsApi </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \JsApi_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//=========步骤1：网页授权获取用户openid============</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//通过code获得openid</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(!</span><span class="pln" style="color:rgb(0,0,0)">isset</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$_GET</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">'code'</span><span class="pun" style="color:rgb(102,102,0)">]))</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//触发微信返回code码</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $url </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $jsApi</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">createOauthUrlForCode</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.JS_API_CALL_URL'</span><span class="pun" style="color:rgb(102,102,0)">));</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="typ" style="color:rgb(102,0,102)">Header</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"Location: $url"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span><span class="kwd" style="color:rgb(0,0,136)">else</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//获取code码，以获取openid</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $code </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $_GET</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">'code'</span><span class="pun" style="color:rgb(102,102,0)">];</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $jsApi</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setCode</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$code</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $openid </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $jsApi</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getOpenId</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//=========步骤2：使用统一支付接口，获取prepay_id============</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用统一支付接口</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \UnifiedOrder_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置统一支付接口参数</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//spbill_create_ip已填,商户无需重复填写</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"openid"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$openid</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商品描述</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"body"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"贡献一分钱"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商品描述</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//自定义订单号，此处仅作举例</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $timeStamp </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> time</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $out_trade_no </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.APPID'</span><span class="pun" style="color:rgb(102,102,0)">).</span><span class="pln" style="color:rgb(0,0,0)">$timeStamp</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"out_trade_no"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$out_trade_no</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商户订单号</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"total_fee"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"1"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//总金额</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"notify_url"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.NOTIFY_URL'</span><span class="pun" style="color:rgb(102,102,0)">));</span><span class="com" style="color:rgb(136,0,0)">//通知地址</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"trade_type"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"JSAPI"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//交易类型</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//非必填参数，商户可根据实际情况选填</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("sub_mch_id","XXXX");//子商户号</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("device_info","XXXX");//设备号</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("attach","XXXX");//附加数据</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("time_start","XXXX");//交易起始时间</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("time_expire","XXXX");//交易结束时间</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("goods_tag","XXXX");//商品标记</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("openid","XXXX");//用户标识</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("product_id","XXXX");//商品ID</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $prepay_id </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getPrepayId</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//=========步骤3：使用jsapi调起支付============</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $jsApi</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setPrepayId</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$prepay_id</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $jsApiParameters </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $jsApi</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getParameters</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">assign</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'jsApiParameters'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$jsApiParameters</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">display</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'pay'</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//echo $jsApiParameters;</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_3" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">这里都是复制微信demo的，改改名字罢了，没什么其他的</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来是异步通知方法，也是复制的微信demo上的</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> notify</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用通用通知接口</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $notify </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \Notify_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//存储微信的回调</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $xml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $GLOBALS</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">'HTTP_RAW_POST_DATA'</span><span class="pun" style="color:rgb(102,102,0)">];</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">saveData</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//验证签名，并回应微信。</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//对后台通知交互时，如果微信收到商户的应答不是成功或超时，微信认为通知失败，</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//微信会通过一定的策略（如30分钟共8次）定期重新发起通知，</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//尽可能提高通知的成功率，但微信不保证通知最终能成功。</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">checkSign</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> FALSE</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回状态码</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_msg"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"签名失败"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回信息</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"SUCCESS"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//设置返回码</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $returnXml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">returnXml</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        echo $returnXml</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//==商户根据实际情况设置相应的处理流程，此处仅作举例=======</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//以log文件形式记录回调信息</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="com" style="color:rgb(136,0,0)">//         $log_ = new Log_();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $log_name</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> __ROOT__</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"/Public/notify_url.log"</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="com" style="color:rgb(136,0,0)">//log文件路径</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【接收到的notify通知】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">checkSign</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> TRUE</span><span class="pun" style="color:rgb(102,102,0)">)</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">data</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">]</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">)</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【通信出错】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            elseif</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">data</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">"result_code"</span><span class="pun" style="color:rgb(102,102,0)">]</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【业务出错】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【支付成功】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//商户自行增加处理流程,</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：更新订单状态</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：数据库操作</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：推送支付完成信息</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_4" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">这里我把记录日志的类写到了function.php中：</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)">  log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$file</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$word</span><span class="pun" style="color:rgb(102,102,0)">)</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    $fp </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> fopen</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$file</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"a"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    flock</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$fp</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> LOCK_EX</span><span class="pun" style="color:rgb(102,102,0)">)</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    fwrite</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$fp</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"执行日期："</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">strftime</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"%Y-%m-%d-%H：%M：%S"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">time</span><span class="pun" style="color:rgb(102,102,0)">()).</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$word</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    flock</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$fp</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> LOCK_UN</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    fclose</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$fp</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_5" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">好了 其实控制器的方法就这么多，没什么其他的了，下面看一下页面，直接上代码吧：</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="dec" style="color:rgb(102,0,102)">&lt;!DOCTYPE html&gt;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;html&gt;</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;head&gt;</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;meta</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">http-equiv</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"content-type"</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">content</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"text/html;charset=utf-8"</span><span class="tag" style="color:rgb(0,0,136)">/&gt;</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;title&gt;</span><span class="pln" style="color:rgb(0,0,0)">微信安全支付</span><span class="tag" style="color:rgb(0,0,136)">&lt;/title&gt;</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"/></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;script</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">type</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"text/javascript"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"/></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//调用微信JS api 支付</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="typ" style="color:rgb(102,0,102)">WeixinJSBridge</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">invoke</span><span class="pun" style="color:rgb(102,102,0)">(</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="str" style="color:rgb(0,136,0)">'getBrandWCPayRequest'</span><span class="pun" style="color:rgb(102,102,0)">,</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="pun" style="color:rgb(102,102,0)">&lt;?</span><span class="pln" style="color:rgb(0,0,0)">php echo $jsApiParameters</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">?&gt;,</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">res</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="typ" style="color:rgb(102,0,102)">WeixinJSBridge</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">log</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">res</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">err_msg</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    alert</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">res</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">err_code</span><span class="pun" style="color:rgb(102,102,0)">+</span><span class="pln" style="color:rgb(0,0,0)">res</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">err_desc</span><span class="pun" style="color:rgb(102,102,0)">+</span><span class="pln" style="color:rgb(0,0,0)">res</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">err_msg</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//alert("{$jsApiParameters}");</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"/></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> callpay</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="kwd" style="color:rgb(0,0,136)">typeof</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="typ" style="color:rgb(102,0,102)">WeixinJSBridge</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"undefined"</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)"> document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">addEventListener </span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">addEventListener</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WeixinJSBridgeReady'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">false</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="pun" style="color:rgb(102,102,0)">}</span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">attachEvent</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">attachEvent</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WeixinJSBridgeReady'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="pln" style="color:rgb(0,0,0)"> </span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">attachEvent</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'onWeixinJSBridgeReady'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                jsApiCall</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/script&gt;</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/head&gt;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;body&gt;</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;&lt;/br&gt;</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;div</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">align</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"center"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="tag" style="color:rgb(0,0,136)">&lt;button</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">style</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"</span><span class="pln" style="color:rgb(0,0,0)">width</span><span class="pun" style="color:rgb(102,102,0)">:</span><span class="lit" style="color:rgb(0,102,102)">210px</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="pln" style="color:rgb(0,0,0)"> height</span><span class="pun" style="color:rgb(102,102,0)">:</span><span class="lit" style="color:rgb(0,102,102)">30px</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="pln" style="color:rgb(0,0,0)"> background</span><span class="pun" style="color:rgb(102,102,0)">-</span><span class="pln" style="color:rgb(0,0,0)">color</span><span class="pun" style="color:rgb(102,102,0)">:</span><span class="com" style="color:rgb(136,0,0)">#FE6714; border:0px #FE6714 solid; cursor: pointer;  color:white;  font-size:16px;</span><span class="atv" style="color:rgb(0,136,0)">"</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">type</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"button"</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">onclick</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"</span><span class="pln" style="color:rgb(0,0,0)">callpay</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="atv" style="color:rgb(0,136,0)">"</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&gt;</span><span class="pln" style="color:rgb(0,0,0)">贡献一下</span><span class="tag" style="color:rgb(0,0,136)">&lt;/button&gt;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/div&gt;</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/body&gt;</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/html&gt;</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_6" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">无须改动什么，直接复制就好</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来是微信公众平台上的配置了，这里我遇到过问题，如果有在这里遇到问题的同学请留言，比如出现了access_deined或者access_notallowed等问题，这都可能是因为这里配置不对。</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">请看配置过程截图：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b49850d477.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b49850d477.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">点击修改进入配置：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b49f4bd129.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b49f4bd129.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">好了，可以测试了：下面是我的测试截图：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">用微信扫描二维码</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-08/559cfe153a828.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-08/559cfe153a828.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">微信上点击贡献一下出现支付页面：</span><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4b1dc4d63.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b4b1dc4d63.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">到此为止，微信JSAPI支付功能就全部做好了</span>&#13;
&#13;
                      </div>  </body>
            </html>