<!DOCTYPE html>
            <html>
              <head>
                <meta http-equiv="content-type" content="text/html; charset=utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
                <meta name="apple-mobile-web-app-status-bar-style" content="black">

                <meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />

                <title></title>
              </head>
              <body><div class="skin_detail" id="article_content">&#13;
                        &#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">大家好，这篇文章是继微信支付jsapi篇之后的微信支付系列教程第二篇：扫码支付之模式一</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">介绍下扫码支付目前有两种模式，模式一比模式二稍微复杂点，至于模式一与模式二的具体内容，流程，微信开发文档都有详细介绍，这里就不多说废话，接下来赶紧上教程！</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">首先我们还是一样，导入微信支付的类库：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b5a9940bd6.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b5a9940bd6.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来是Public下的文件：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b5b0999e51.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b5b0999e51.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">这里的配置跟JSAPI支付一样，不需要改动</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">具体关于文件介绍请参考JSAPI支付，这里就不再说明了 链接地址：</span><a target="_blank" href="http://www.thinkphp.cn/code/1321.html" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">http://www.thinkphp.cn/code/1321.html</a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">接下来直接看控制器部分的代码：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step1：同样，先初始化引入WxPayPubHelper类库</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">/**</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">     * 初始化</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="com" style="color:rgb(136,0,0)">     */</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> _initialize</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//引入WxPayPubHelper</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        vendor</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayPubHelper.WxPayPubHelper'</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_1" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step2：展示扫码页面需要先生存二维码链接</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> native_pay</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置静态链接</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $nativeLink </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \NativeLink_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置静态链接参数</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//time_stamp已填,商户无需重复填写</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $product_id </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.APPID'</span><span class="pun" style="color:rgb(102,102,0)">).</span><span class="str" style="color:rgb(0,136,0)">"static"</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="com" style="color:rgb(136,0,0)">//自定义商品id</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $nativeLink</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"product_id"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$product_id</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商品id</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//获取链接</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $product_url </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $nativeLink</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getUrl</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用短链接转换接口</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $shortUrl </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \ShortUrl_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $shortUrl</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"long_url"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$product_url</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//URL链接</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//获取短链接</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $codeUrl </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $shortUrl</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getShortUrl</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">assign</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'product_url'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$product_url</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">assign</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'codeUrl'</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$codeUrl</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">display</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_2" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">以上代码对应native_pay.html页面</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="dec" style="color:rgb(102,0,102)">&lt;!DOCTYPE HTML&gt;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;html&gt;</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;head&gt;</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;meta</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">charset</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"UTF-8"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;title&gt;</span><span class="pln" style="color:rgb(0,0,0)">微信安全支付</span><span class="tag" style="color:rgb(0,0,136)">&lt;/title&gt;</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/head&gt;</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;body&gt;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;div</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">align</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"center"</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">id</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"qrcode"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="tag" style="color:rgb(0,0,136)">&lt;p</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&gt;</span><span class="pln" style="color:rgb(0,0,0)">扫我，扫我</span><span class="tag" style="color:rgb(0,0,136)">&lt;/p&gt;</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/div&gt;</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;div</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">align</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"center"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="tag" style="color:rgb(0,0,136)">&lt;a</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">href</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"#"</span><span class="tag" style="color:rgb(0,0,136)">&gt;</span><span class="pln" style="color:rgb(0,0,0)">返回首页</span><span class="tag" style="color:rgb(0,0,136)">&lt;/a&gt;</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/div&gt;</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/body&gt;</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;script</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="atn" style="color:rgb(102,0,102)">src</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="atv" style="color:rgb(0,136,0)">"__PUBLIC__/js/qrcode.js"</span><span class="tag" style="color:rgb(0,0,136)">&gt;&lt;/script&gt;</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;script&gt;</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">var</span><span class="pln" style="color:rgb(0,0,0)"> url </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"&lt;?php echo $product_url;?&gt;"</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//参数1表示图像大小，取值范围1-10；参数2表示质量，取值范围'L','M','Q','H'</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">var</span><span class="pln" style="color:rgb(0,0,0)"> qr </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> qrcode</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="lit" style="color:rgb(0,102,102)">10</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">'M'</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        qr</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">addData</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">url</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        qr</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">make</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">var</span><span class="pln" style="color:rgb(0,0,0)"> dom</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)">document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">createElement</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'DIV'</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        dom</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">innerHTML </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> qr</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">createImgTag</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">var</span><span class="pln" style="color:rgb(0,0,0)"> element</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)">document</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">getElementById</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"qrcode"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        element</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">appendChild</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">dom</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="tag" style="color:rgb(0,0,136)">&lt;/script&gt;</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"> </span><span class="tag" style="color:rgb(0,0,136)">&lt;/html&gt;</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_3" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">这里注意生存二维码的js地址，我放在了Public下的JS目录下</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step3：扫码之后，就会提交给我们公众平台native配置的地址对应的去方法处理</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">公众平台navtive配置：配置地址 http://您的域名/Pay/index.php/Home/WxNative/todoPost</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b60f1c235b.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b60f1c235b.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">对应的todoPost方法在控制器中：</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> todoPost</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//以log文件形式记录回调信息，用于调试</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $log_name </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> __ROOT__</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"/Public/native_call.log"</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用native通知接口</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $nativeCall </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \NativeCall_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//接收微信请求</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $xml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $GLOBALS</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">'HTTP_RAW_POST_DATA'</span><span class="pun" style="color:rgb(102,102,0)">];</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【接收到的native通知】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">saveData</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">checkSign</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> FALSE</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回状态码</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_msg"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"签名失败"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回信息</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">else</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//提取product_id</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $product_id </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getProductId</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//使用统一支付接口</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $unifiedOrder </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \UnifiedOrder_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//根据不同的$product_id设定对应的下单参数，此处只举例一种</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">switch</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$product_id</span><span class="pun" style="color:rgb(102,102,0)">)</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="kwd" style="color:rgb(0,0,136)">case</span><span class="pln" style="color:rgb(0,0,0)"> C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.APPID'</span><span class="pun" style="color:rgb(102,102,0)">).</span><span class="str" style="color:rgb(0,136,0)">"static"</span><span class="pun" style="color:rgb(102,102,0)">:</span><span class="com" style="color:rgb(136,0,0)">//与native_call_qrcode.php中的静态链接二维码对应</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置统一支付接口参数</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//spbill_create_ip已填,商户无需重复填写</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"body"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"贡献一分钱"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商品描述</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//自定义订单号，此处仅作举例</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $timeStamp </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> time</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $out_trade_no </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.APPID'</span><span class="pun" style="color:rgb(102,102,0)">).</span><span class="pln" style="color:rgb(0,0,0)">$timeStamp</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"out_trade_no"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$out_trade_no</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//商户订单号             $unifiedOrder-&gt;setParameter("product_id","$product_id");//商品ID</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"total_fee"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"1"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//总金额</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"notify_url"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">C</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">'WxPayConf_pub.NOTIFY_URL'</span><span class="pun" style="color:rgb(102,102,0)">));</span><span class="com" style="color:rgb(136,0,0)">//通知地址</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"trade_type"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"NATIVE"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//交易类型</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"product_id"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$product_id</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//用户标识</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//非必填参数，商户可根据实际情况选填</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("sub_mch_id","XXXX");//子商户号</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("device_info","XXXX");//设备号</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("attach","XXXX");//附加数据</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("time_start","XXXX");//交易起始时间</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("time_expire","XXXX");//交易结束时间</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("goods_tag","XXXX");//商品标记</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//$unifiedOrder-&gt;setParameter("openid","XXXX");//用户标识</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//获取prepay_id</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $prepay_id </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $unifiedOrder</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">getPrepayId</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置返回码</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"SUCCESS"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回状态码</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"result_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"SUCCESS"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//业务结果</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"prepay_id"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="pln" style="color:rgb(0,0,0)">$prepay_id</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//预支付ID</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="kwd" style="color:rgb(0,0,136)">break</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="kwd" style="color:rgb(0,0,136)">default</span><span class="pun" style="color:rgb(102,102,0)">:</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置返回码</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//设置必填参数</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//appid已填,商户无需重复填写</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//mch_id已填,商户无需重复填写</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//noncestr已填,商户无需重复填写</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="com" style="color:rgb(136,0,0)">//sign已填,商户无需重复填写</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"SUCCESS"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回状态码</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"result_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//业务结果</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"err_code_des"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"此商品无效"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//业务结果</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                    </span><span class="kwd" style="color:rgb(0,0,136)">break</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//将结果返回微信</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $returnXml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $nativeCall</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">returnXml</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【返回微信的native响应】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$returnXml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)"/></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        echo $returnXml</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_4" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">其实到这里你已经完成了扫码支付模式一的功能</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">step4:接下来写一下异步通知处理，与jsapi支付一样：</span><code class="prettyprint linenums lang-php prettyprinted" style="position:relative; border:1px solid rgb(209,215,220); padding:2px; font-size:14px; display:block; font-family:Consolas,'Liberation Mono',Courier,monospace,微软雅黑; margin:10px 0px; word-wrap:break-word; color:rgb(50,50,50)"/>&#13;
<ol class="linenums" style="margin:0px 0px 0px 40px; padding:0px; color:rgb(43,165,216); list-style-position:outside"><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="kwd" style="color:rgb(0,0,136)">public</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">function</span><span class="pln" style="color:rgb(0,0,0)"> notify</span><span class="pun" style="color:rgb(102,102,0)">()</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//使用通用通知接口</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $notify </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="kwd" style="color:rgb(0,0,136)">new</span><span class="pln" style="color:rgb(0,0,0)"> \Notify_pub</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//存储微信的回调</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $xml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $GLOBALS</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">'HTTP_RAW_POST_DATA'</span><span class="pun" style="color:rgb(102,102,0)">];</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">saveData</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//验证签名，并回应微信。</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//对后台通知交互时，如果微信收到商户的应答不是成功或超时，微信认为通知失败，</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//微信会通过一定的策略（如30分钟共8次）定期重新发起通知，</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//尽可能提高通知的成功率，但微信不保证通知最终能成功。</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">checkSign</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> FALSE</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回状态码</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_msg"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"签名失败"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//返回信息</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">setReturnParameter</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"SUCCESS"</span><span class="pun" style="color:rgb(102,102,0)">);</span><span class="com" style="color:rgb(136,0,0)">//设置返回码</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $returnXml </span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> $notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">returnXml</span><span class="pun" style="color:rgb(102,102,0)">();</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        echo $returnXml</span><span class="pun" style="color:rgb(102,102,0)">;</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//==商户根据实际情况设置相应的处理流程，此处仅作举例=======</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//以log文件形式记录回调信息</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="com" style="color:rgb(136,0,0)">//         $log_ = new Log_();</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $log_name</span><span class="pun" style="color:rgb(102,102,0)">=</span><span class="pln" style="color:rgb(0,0,0)"> __ROOT__</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"/Public/notify_url.log"</span><span class="pun" style="color:rgb(102,102,0)">;</span><span class="com" style="color:rgb(136,0,0)">//log文件路径</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        $this</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【接收到的notify通知】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">         </span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">checkSign</span><span class="pun" style="color:rgb(102,102,0)">()</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> TRUE</span><span class="pun" style="color:rgb(102,102,0)">)</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">if</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">data</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">"return_code"</span><span class="pun" style="color:rgb(102,102,0)">]</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">)</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【通信出错】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            elseif</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$notify</span><span class="pun" style="color:rgb(102,102,0)">-&gt;</span><span class="pln" style="color:rgb(0,0,0)">data</span><span class="pun" style="color:rgb(102,102,0)">[</span><span class="str" style="color:rgb(0,136,0)">"result_code"</span><span class="pun" style="color:rgb(102,102,0)">]</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="pun" style="color:rgb(102,102,0)">==</span><span class="pln" style="color:rgb(0,0,0)"> </span><span class="str" style="color:rgb(0,136,0)">"FAIL"</span><span class="pun" style="color:rgb(102,102,0)">){</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【业务出错】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="kwd" style="color:rgb(0,0,136)">else</span><span class="pun" style="color:rgb(102,102,0)">{</span></li><li class="L1" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                </span><span class="com" style="color:rgb(136,0,0)">//此处应该更新一下订单状态，商户自行增删操作</span></li><li class="L2" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">                log_result</span><span class="pun" style="color:rgb(102,102,0)">(</span><span class="pln" style="color:rgb(0,0,0)">$log_name</span><span class="pun" style="color:rgb(102,102,0)">,</span><span class="str" style="color:rgb(0,136,0)">"【支付成功】:\n"</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="pln" style="color:rgb(0,0,0)">$xml</span><span class="pun" style="color:rgb(102,102,0)">.</span><span class="str" style="color:rgb(0,136,0)">"\n"</span><span class="pun" style="color:rgb(102,102,0)">);</span></li><li class="L3" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L4" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">             </span></li><li class="L5" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//商户自行增加处理流程,</span></li><li class="L6" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：更新订单状态</span></li><li class="L7" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：数据库操作</span></li><li class="L8" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">            </span><span class="com" style="color:rgb(136,0,0)">//例如：推送支付完成信息</span></li><li class="L9" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">        </span><span class="pun" style="color:rgb(102,102,0)">}</span></li><li class="L0" style="margin:0px; padding:0px 5px; border-left-width:1px; border-left-style:solid; border-left-color:rgb(209,215,220); line-height:23px; background-color:rgb(250,250,250)">&#13;
<span class="pln" style="color:rgb(0,0,0)">    </span><span class="pun" style="color:rgb(102,102,0)">}</span></li></ol><div class="think-copy" style="position:absolute; top:-1px; right:-1px; width:80px; height:27px; line-height:27px; text-align:center; border:1px solid rgb(204,204,204)">&#13;
<span style="display:inline-block; width:80px; height:27px">复制代码</span></div>&#13;
<div class="zclip" id="zclip-ZeroClipboardMovie_5" style="position:absolute; left:605px; top:-1px; width:82px; height:29px; z-index:99">&#13;
</div>&#13;
<span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">native扫码支付模式一demo到此就可以啦</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">下面展示下测试的截图：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">扫码界面：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b6219a37c7.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b6219a37c7.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">扫码结果：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b62c6ad14f.png" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"><img src="http://www.thinkphp.cn/Uploads/editor/2015-07-07/559b62c6ad14f.png" alt="" style="margin:10px 0px; padding:0px; border:0px; max-width:688px"/></a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">有问题请留言，下面还会介绍微信扫码支付模式二的详细教程</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">微信支付教程jsapi篇：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/code/1321.html" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">http://www.thinkphp.cn/code/1321.html</a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">微信支付教程扫码模式二：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/code/1323.html" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">http://www.thinkphp.cn/code/1323.html</a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">微信支付教程刷卡支付：</span><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><a target="_blank" href="http://www.thinkphp.cn/code/1324.html" style="color:rgb(114,185,57); text-decoration:none; font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">http://www.thinkphp.cn/code/1324.html</a><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><br style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px"/><span style="color:rgb(50,50,50); font-family:'Century Gothic','Microsoft yahei'; font-size:16px; line-height:28.8px">欢迎大家吐槽，转载请说明出处，请支持原创，谢谢！</span>&#13;
&#13;
                      </div>  </body>
            </html>