<!DOCTYPE html>
            <html>
              <head>
                <meta http-equiv="content-type" content="text/html; charset=utf-8">
                <meta http-equiv="X-UA-Compatible" content="IE=Edge">
                <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
                <meta name="apple-mobile-web-app-status-bar-style" content="black">

                <meta http-equiv="Cache-Control" content="no-siteapp" /><link rel="alternate" media="handheld" href="#" />

                <title></title>
              </head>
              <body><div class="skin_detail" id="article_content">&#13;
                        &#13;
<p><span style="font-size:18px; color:#ff0000"><strong>1、使用ajax与服务器通信的的步骤:</strong></span></p>&#13;
<p><span style="font-size:18px">①     创建一个XMLHttpRequest对象</span></p>&#13;
<p><span style="font-size:18px">②     创建url,data,通过 xmlHttpRequest.send()</span></p>&#13;
<p><span style="font-size:18px">③     服务器端接收 ajax的请求,做相应处理(操作数据库)，然后返回结果(用 echo 语句返回结果)</span></p>&#13;
<p><span style="font-size:18px">④     客户端通过xmlHttpRequest的属性 reponseText , responseXML 取的数据，然后就完成局部刷新当前页面任务</span></p>&#13;
<p><span style="font-size:18px"/></p>&#13;
<h2 style="border:0px; margin:2px 0px; padding:0px; line-height:1.8em; font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,STHeiti,'Microsoft Yahei',sans-serif">&#13;
<span style="font-size:18px; color:#ff0000">2、XMLHttpRequest 对象属性</span></h2>&#13;
<table class="reference notranslate " style="font-weight:bold; border:0px; margin:4px 0px; padding:0px; border-collapse:collapse; width:729px; color:rgb(51,51,51); font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,STHeiti,'Microsoft Yahei',sans-serif"><tbody style="border:0px; margin:0px; padding:0px"><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><th width="35%" style="border:1px solid rgb(85,85,85); margin:0px; padding:3px; color:rgb(255,255,255); vertical-align:top; background-color:rgb(85,85,85)">&#13;
属性</th>&#13;
<th width="65%" style="border:1px solid rgb(85,85,85); margin:0px; padding:3px; color:rgb(255,255,255); vertical-align:top; background-color:rgb(85,85,85)">&#13;
描述</th>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
onreadystatechange</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
存储函数（或函数的名称）在每次 readyState 属性变化时被自动调用。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
readyState</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
存放了 XMLHttpRequest 的状态。从 0 到 4 变化：<br/>&#13;
0：请求未初始化<br/>&#13;
1：服务器建立连接<br/>&#13;
2：收到的请求<br/>&#13;
3：处理请求<br/>&#13;
4：请求完成和响应准备就绪</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
responseText</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回作为一个字符串的响应数据。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
responseXML</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回作为 XML 数据响应数据。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
status</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回状态数（例如 "404" 为 "Not Found" 或 "200" 为 "OK"）。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
statusText</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回状态文本（如 "Not Found" 或 "OK"）。</td>&#13;
</tr></tbody></table><p/>&#13;
<p><span style="font-size:18px"/></p>&#13;
<h2 style="border:0px; margin:2px 0px; padding:0px; line-height:1.8em; font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,STHeiti,'Microsoft Yahei',sans-serif">&#13;
<span style="font-size:18px; color:#ff0000">3、XMLHttpRequest 对象方法</span></h2>&#13;
<table class="reference notranslate " style="font-weight:bold; border:0px; margin:4px 0px; padding:0px; border-collapse:collapse; width:729px; color:rgb(51,51,51); font-family:'Open Sans','Helvetica Neue',Helvetica,Arial,STHeiti,'Microsoft Yahei',sans-serif"><tbody style="border:0px; margin:0px; padding:0px"><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><th width="35%" style="border:1px solid rgb(85,85,85); margin:0px; padding:3px; color:rgb(255,255,255); vertical-align:top; background-color:rgb(85,85,85)">&#13;
方法</th>&#13;
<th width="65%" style="border:1px solid rgb(85,85,85); margin:0px; padding:3px; color:rgb(255,255,255); vertical-align:top; background-color:rgb(85,85,85)">&#13;
描述</th>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
abort()</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
取消当前的请求。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
getAllResponseHeaders()</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回头信息。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
getResponseHeader()</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
返回指定的头信息。</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
open(method,url,async,uname,pswd)</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
规定请求的类型，URL，请求是否应该进行异步处理，以及请求的其他可选属性。 <br/><br/>&#13;
method：请求的类型：GET 或 POST<br/>&#13;
url：文件在服务器上的位置<br/>&#13;
async：true（异步）或 false（同步）</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
send(string)</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
发送请求到服务器。<br/><br/>&#13;
string：仅用于 POST 请求</td>&#13;
</tr><tr style="border:0px; margin:0px; padding:0px; background-color:rgb(246,244,240)"><td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
setRequestHeader()</td>&#13;
<td style="border:1px solid rgb(212,212,212); margin:0px; padding:7px 5px; vertical-align:top">&#13;
把标签/值对添加到要发送的头文件。</td>&#13;
</tr></tbody></table><p/>&#13;
<p><span style="font-size:18px; color:#ff0000"><strong>4、ajax发送get请求方法：</strong></span></p>&#13;
<p><span style="font-size:18px"/></p><pre name="code" class="javascript" style="font-weight: bold;">&lt;script&gt;
function loadXMLDoc(){
	var xmlhttp;
	//创建一个XMLHttpRequest对象
	if (window.XMLHttpRequest){
		// code for IE7+, Firefox, Chrome, Opera, Safari
		//对于以上浏览器采用下面方法创建
		xmlhttp=new XMLHttpRequest();
	}else{
			// code for IE6, IE5
			//对于以上浏览器采用下面方法创建
		xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
	}
	//每次readyState发生变化时执行以下函数
	xmlhttp.onreadystatechange=function(){
		if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){
			//将ajax请求返回的值赋给id为 myDiv的元素
			document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
		}
	}
	//规定请求的类型，URL，请求是否应该进行异步处理，以及请求的其他可选属性。 
	xmlhttp.open("GET","/try/ajax/demo_get.php",true);
	//发送请求
	xmlhttp.send();
}
&lt;/script&gt;</pre><span style="color:#ff0000"><strong>5、以用户注册为例，以get方式发送请求实例：</strong></span>&#13;
<p><strong><span style="font-size:18px"><span style="background-color:rgb(255,255,102)">register.php</span><br/></span></strong></p>&#13;
<p><strong><span style="font-size:18px"/></strong></p><pre name="code" class="php">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;用户注册&lt;/title&gt;
&lt;meta http-equiv="content-type" content="text/html;charset=utf-8"/&gt;
&lt;script type="text/javascript"&gt;
	//创建ajax引擎
	function getXmlHttpObject(){
		var xmlHttpRequest;
		//不同的浏览器获取对象xmlhttprequest 对象方法不一样
		if(window.ActiveXObject){
			xmlHttpRequest=new ActiveXObject("Microsoft.XMLHTTP");
		}else{
			xmlHttpRequest=new XMLHttpRequest();
		}
		return xmlHttpRequest;
	}
	var myXmlHttpRequest="";
	//验证用户名是否存在
	function checkName(){
		myXmlHttpRequest=getXmlHttpObject();
		//怎么判断创建ok
		if(myXmlHttpRequest){
			//通过myXmlHttpRequest对象发送请求到服务器的某个页面
			//第一个参数表示请求的方式, "get" / "post"
			//第二个参数指定url,对哪个页面发出ajax请求(本质仍然是http请求)
			//第三个参数表示 true表示使用异步机制,如果false表示不使用异步,即同步机制。
			var url="/ajax/registerProcess.php?mytime="+new  Date()+"&amp;username="+$("username").value;
			//打开请求.
			myXmlHttpRequest.open("get",url,true);
			//指定回调函数.chuli是函数名
			myXmlHttpRequest.onreadystatechange=chuli;
			//真的发送请求,如果是get请求则填入 null即可
			//如果是post请求，则填入实际的数据
			myXmlHttpRequest.send(null); 
		}
	}

	//回调函数
	function chuli(){
		//window.alert("处理函数被调回"+myXmlHttpRequest.readyState);
		//我要取出从registerPro.php页面返回的数据
		if(myXmlHttpRequest.readyState==4){
			//取出值,根据返回信息的格式定.text
			//window.alert("服务器返回"+myXmlHttpRequest.responseText);
			$('myres').value=myXmlHttpRequest.responseText;
		}
	}
	//这里我们写一个函数
	function $(id){
		return document.getElementById(id);
	}
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;form action="???" method="post"&gt;
    用户名字:&lt;input type="text"  onkeyup="checkName();"  name="username1" id="username"&gt;&lt;input type="button" onclick="checkName();"  value="验证用户名"&gt;
    &lt;input style="border-width: 0;color: red" type="text" id="myres"&gt;
    &lt;br/&gt;
    用户密码:&lt;input type="password" name="password"&gt;&lt;br&gt;
    电子邮件:&lt;input type="text" name="email"&gt;&lt;br/&gt;
    &lt;input type="submit" value="用户注册"&gt;
    &lt;/form&gt;
     &lt;form action="???" method="post"&gt;
    用户名字:&lt;input type="text" name="username2" &gt;
   
    &lt;br/&gt;
    用户密码:&lt;input type="password" name="password"&gt;&lt;br&gt;
    电子邮件:&lt;input type="text" name="email"&gt;&lt;br/&gt;
    &lt;input type="submit" value="用户注册"&gt;
    &lt;/form&gt;

&lt;/body&gt;
&lt;/html&gt;</pre><br/><span style="background-color:rgb(255,255,102)">registerpro.php</span><br/><p/><pre name="code" class="php">&lt;span style="font-size:18px;"&gt;&lt;?php
	//这里两句话很重要,第一讲话告诉浏览器返回的数据是xml格式
	header("Content-Type: text/xml;charset=utf-8");
	//告诉浏览器不要缓存数据
	header("Cache-Control: no-cache");
	//接收数据
	$username=$_GET['username'];
	if($username=="shunping"){
	    //注意，这里数据是返回给请求的页面.用echo语句返回
		echo "用户名不可以用";
	}else{
		echo "用户名可以用";
	}
?&gt;	&lt;/span&gt;</pre><span style="font-size:18px"><br/></span>&#13;
<p><strong><span style="font-size:18px"><span style="font-weight:bold"><span style="color:#ff0000"> 6、ajax发送post请求方法：</span></span><br/></span></strong></p>&#13;
<p><span style="font-size:18px"/></p><pre name="code" class="javascript" style="font-weight: bold;">&lt;script&gt;
function loadXMLDoc(){
    var xmlhttp;
    if (window.XMLHttpRequest){
        // code for IE7+, Firefox, Chrome, Opera, Safari
        xmlhttp=new XMLHttpRequest();
    }else{
        // code for IE6, IE5
        xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
    }
    xmlhttp.onreadystatechange=function(){
        if (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200){
            document.getElementById("myDiv").innerHTML=xmlhttp.responseText;
        }
    }
    xmlhttp.open("POST","/try/ajax/demo_post2.php",true);
    //下面这句话必须有
    //把标签/值对添加到要发送的头文件。
    xmlhttp.setRequestHeader("Content-type","application/x-www-form-urlencoded");
    xmlhttp.send("fname=Henry&amp;lname=Ford");
    }
&lt;/script&gt;</pre><br/><p><span style="color:#ff0000"><strong>7、使用get方式发出请求，如果提交的用户名不变化，浏览器将不会真的发请求，而是从缓存取数据、url</strong></span></p>&#13;
<p>解决方法：</p>&#13;
<p>1、url 后带一个总是变化的参数,比如当前时间</p>&#13;
<p>      varurl="/ajax/registerProcess.php?mytime="+new Date()+"&amp;username="+$("username").value;</p>&#13;
<p>2、在服务器回送结果时，禁用缓存.</p>&#13;
<p><span style="white-space:pre"/>//这里两句话很重要,第一讲话告诉浏览器返回的数据是xml格式</p>&#13;
<p><span style="white-space:pre"/>header("Content-Type:text/xml;charset=utf-8");</p>&#13;
<p><span style="white-space:pre"/>//告诉浏览器不要缓存数据</p>&#13;
<p><span style="white-space:pre"/>header("Cache-Control:no-cache");</p>&#13;
<p style="font-weight:bold"><br/></p>&#13;
&#13;
                      </div>  </body>
            </html>